<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.trkj.projects.mybatis.dao.SysUserDao">

    <resultMap type="com.trkj.projects.mybatis.entity.SysUser" id="SysUserMap">
        <result property="userId" column="user_id" jdbcType="INTEGER"/>
        <result property="userName" column="user_name" jdbcType="VARCHAR"/>
        <result property="userPass" column="user_pass" jdbcType="VARCHAR"/>
        <result property="userSex" column="user_sex" jdbcType="VARCHAR"/>
        <result property="userPhone" column="user_phone" jdbcType="VARCHAR"/>
        <result property="userImgs" column="user_imgs" jdbcType="VARCHAR"/>
        <result property="userCjr" column="user_cjr" jdbcType="VARCHAR"/>
        <result property="userGxr" column="user_gxr" jdbcType="VARCHAR"/>
        <result property="userstate" column="user_state" jdbcType="INTEGER"/>
        <result property="userError" column="user_error" jdbcType="TIMESTAMP"/>
        <result property="userStatie" column="user_statie" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="Rosle_vo" type="com.trkj.projects.vo.SysUser_roles">
        <result property="user_id" column="user_id" jdbcType="INTEGER"></result>
        <result property="user_name" column="user_name" jdbcType="VARCHAR"></result>
        <result property="roles_lv" column="roles_lv" jdbcType="INTEGER"></result>
        <result property="roles_name" column="roles_name" jdbcType="VARCHAR"></result>
        <result property="user_state" column="user_state" jdbcType="INTEGER"></result>
    </resultMap>

    <select id="findByNames" resultMap="SysUserMap">
        select
          user_id, user_name, user_pass, user_sex, user_phone, user_imgs, user_cjr, user_gxr, user_state, user_error,user_statie
        from projects.sys_user
        where user_name = #{param1} and user_pass= #{param2}
    </select>

    <select id="findByPhone" resultMap="SysUserMap">
        SELECT * FROM `sys_user` WHERE `user_phone` = #{phone}
    </select>
<!--  根据当前登录的用户查询他的角色  -->
    <select id="findByUser_roles" resultMap="Rosle_vo">
        SELECT su.user_id,su.user_name,sr.roles_name,su.user_state,roles_lv FROM sys_user su
        LEFT JOIN sys_user_roles sur ON su.user_id = sur.user_id
        LEFT JOIN sys_roles sr ON sr.roles_id = sur.roles_id
        WHERE su.user_id=#{uid}
    </select>
<!-- 查询所有用户 -->
    <select id="selectuserall" resultMap="Rosle_vo">
        SELECT su.user_id,su.user_name,sr.roles_name,su.user_state,roles_lv FROM sys_user su
		LEFT JOIN sys_user_roles sur ON su.user_id = sur.user_id
		LEFT JOIN sys_roles sr ON sr.roles_id = sur.roles_id
    </select>
</mapper>

