<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.trkj.projects.mybatis.dao.DocumentListDao">

    <resultMap type="com.trkj.projects.mybatis.entity.DocumentList" id="DocumentListMap">
        <result property="id" column="id" jdbcType="INTEGER"/>
        <result property="dlNumber" column="dl_number" jdbcType="VARCHAR"/>
        <result property="dlDate" column="dl_date" jdbcType="TIMESTAMP"/>
        <result property="supplierid" column="supplierid" jdbcType="INTEGER"/>
        <result property="wid" column="wid" jdbcType="INTEGER"/>
        <result property="dlYfje" column="dl_yfje" jdbcType="NUMERIC"/>
        <result property="dlSfje" column="dl_sfje" jdbcType="NUMERIC"/>
        <result property="dlQkje" column="dl_qkje" jdbcType="NUMERIC"/>
        <result property="dlYhje" column="dl_yhje" jdbcType="NUMERIC"/>
        <result property="agentId" column="agent_id" jdbcType="INTEGER"/>
        <result property="admin" column="admin" jdbcType="INTEGER"/>
        <result property="dlTypeId" column="dl_type_id" jdbcType="INTEGER"/>
        <result property="dlStatieId" column="dl_statie_id" jdbcType="INTEGER"/>
        <result property="dlBeizhu" column="dl_beizhu" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap type="com.trkj.projects.vo.DocumentlistVo" id="DocumentListVOMap">
        <result property="dlNumber" column="dl_number" jdbcType="VARCHAR"/>
        <result property="dlDate" column="dl_date" jdbcType="TIMESTAMP"/>
        <result property="suppliername" column="suppliername" jdbcType="VARCHAR"/>
        <result property="wname" column="wname" jdbcType="VARCHAR"/>
        <result property="dlyfje" column="dl_yfje" jdbcType="NUMERIC"/>
        <result property="dlsfje" column="dl_sfje" jdbcType="NUMERIC"/>
        <result property="dlqkje" column="dl_qkje" jdbcType="NUMERIC"/>
        <result property="dlyhje" column="dl_yhje" jdbcType="NUMERIC"/>
        <result property="agentname" column="agent_name" jdbcType="VARCHAR"/>
        <result property="username" column="user_name" jdbcType="VARCHAR"/>
        <result property="dltypename" column="dl_type_name" jdbcType="VARCHAR"/>
        <result property="dlstatiename" column="dl_statie_name" jdbcType="VARCHAR"/>
        <result property="dlbeizhu" column="dl_beizhu" jdbcType="VARCHAR"/>
        <result property="branchname" column="branchname" jdbcType="VARCHAR"/>
        <result property="branchid" column="branchid" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap type="com.trkj.projects.vo.CgdjVo" id="CghzVo">
        <result property="dlDate" column="dl_date" jdbcType="VARCHAR"/>
        <result property="dlNumber" column="dl_number" jdbcType="VARCHAR"/>
        <result property="dlYFje" column="dl_yfje" jdbcType="NUMERIC"/>
        <result property="dlSFje" column="dl_sfje" jdbcType="NUMERIC"/>
        <result property="dlBeiZhu" column="dl_beizhu" jdbcType="VARCHAR"/>
        <result property="agentName" column="agent_name" jdbcType="VARCHAR"/>
        <result property="WName" column="wname" jdbcType="VARCHAR"/>
        <result property="userName" column="user_name" jdbcType="VARCHAR"/>
        <result property="supplierName" column="suppliername" jdbcType="VARCHAR"/>
    </resultMap>
    <!--查询单个-->
    <select id="queryById" resultMap="DocumentListMap">
        select
          id, dl_number, dl_date, supplierid, wid, dl_yfje, dl_sfje, dl_qkje, dl_yhje, agent_id, admin, dl_type_id, dl_statie_id, dl_beizhu
        from projects.document_list
        where id = #{id}
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="DocumentListMap">
        select
          id, dl_number, dl_date, supplierid, wid, dl_yfje, dl_sfje, dl_qkje, dl_yhje, agent_id, admin, dl_type_id, dl_statie_id, dl_beizhu
        from projects.document_list
        limit #{offset}, #{limit}
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="queryAll" resultMap="DocumentListMap">
        select
        id, dl_number, dl_date, supplierid, wid, dl_yfje, dl_sfje, dl_qkje, dl_yhje, agent_id, admin, dl_type_id,
        dl_statie_id, dl_beizhu
        from projects.document_list
        <where>
            <if test="dlNumber != null and dlNumber != ''">
                and dl_number = #{dlNumber}
            </if>
            <if test="dlDate != null">
                and dl_date = #{dlDate}
            </if>
            <if test="supplierid != null">
                and supplierid = #{supplie`rid}
            </if>
            <if test="wid != null">
                and wid = #{wid}
            </if>
            <if test="dlYfje != null">
                and dl_yfje = #{dlYfje}
            </if>
            <if test="dlSfje != null">
                and dl_sfje = #{dlSfje}
            </if>
            <if test="dlQkje != null">
                and dl_qkje = #{dlQkje}
            </if>
            <if test="dlYhje != null">
                and dl_yhje = #{dlYhje}
            </if>
            <if test="agentId != null">
                and agent_id = #{agentId}
            </if>
            <if test="admin != null">
                and admin = #{admin}
            </if>
            <if test="dlTypeId != null">
                and dl_type_id = #{dlTypeId}
            </if>
            <if test="dlStatieId != null">
                and dl_statie_id = #{dlStatieId}
            </if>
            <if test="dlBeizhu != null and dlBeizhu != ''">
                and dl_beizhu = #{dlBeizhu}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into projects.document_list(dl_number, dl_date, supplierid, wid, dl_yfje, dl_sfje, dl_qkje, dl_yhje, agent_id, admin, dl_type_id, dl_statie_id, dl_beizhu)
        values (#{dlNumber}, #{dlDate}, #{supplierid}, #{wid}, #{dlYfje}, #{dlSfje}, #{dlQkje}, #{dlYhje}, #{agentId}, #{admin}, #{dlTypeId}, #{dlStatieId}, #{dlBeizhu})
    </insert>

    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">
        insert into projects.document_list(dl_number, dl_date, supplierid, wid, dl_yfje, dl_sfje, dl_qkje, dl_yhje,
        agent_id, admin, dl_type_id, dl_statie_id, dl_beizhu)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.dlNumber}, #{entity.dlDate}, #{entity.supplierid}, #{entity.wid}, #{entity.dlYfje},
            #{entity.dlSfje}, #{entity.dlQkje}, #{entity.dlYhje}, #{entity.agentId}, #{entity.admin},
            #{entity.dlTypeId}, #{entity.dlStatieId}, #{entity.dlBeizhu})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">
        insert into projects.document_list(dl_number, dl_date, supplierid, wid, dl_yfje, dl_sfje, dl_qkje, dl_yhje,
        agent_id, admin, dl_type_id, dl_statie_id, dl_beizhu)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.dlNumber}, #{entity.dlDate}, #{entity.supplierid}, #{entity.wid}, #{entity.dlYfje},
            #{entity.dlSfje}, #{entity.dlQkje}, #{entity.dlYhje}, #{entity.agentId}, #{entity.admin},
            #{entity.dlTypeId}, #{entity.dlStatieId}, #{entity.dlBeizhu})
        </foreach>
        on duplicate key update
        dl_number = values(dl_number) , dl_date = values(dl_date) , supplierid = values(supplierid) , wid = values(wid)
        , dl_yfje = values(dl_yfje) , dl_sfje = values(dl_sfje) , dl_qkje = values(dl_qkje) , dl_yhje = values(dl_yhje)
        , agent_id = values(agent_id) , admin = values(admin) , dl_type_id = values(dl_type_id) , dl_statie_id =
        values(dl_statie_id) , dl_beizhu = values(dl_beizhu)
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update projects.document_list
        <set>
            <if test="dlDate != null">
                dl_date = #{dlDate},
            </if>
            <if test="supplierid != null">
                supplierid = #{supplierid},
            </if>
            <if test="wid != null">
                wid = #{wid},
            </if>
            <if test="dlYfje != null">
                dl_yfje = #{dlYfje},
            </if>
            <if test="dlSfje != null">
                dl_sfje = #{dlSfje},
            </if>
            <if test="dlQkje != null">
                dl_qkje = #{dlQkje},
            </if>
            <if test="dlYhje != null">
                dl_yhje = #{dlYhje},
            </if>
            <if test="agentId != null">
                agent_id = #{agentId},
            </if>
            <if test="admin != null">
                admin = #{admin},
            </if>
            <if test="dlTypeId != null">
                dl_type_id = #{dlTypeId},
            </if>
            <if test="dlStatieId != null">
                dl_statie_id = #{dlStatieId},
            </if>
            <if test="dlBeizhu != null and dlBeizhu != ''">
                dl_beizhu = #{dlBeizhu},
            </if>
        </set>
        where dl_number = #{dlNumber}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete from projects.document_list where id = #{id}
    </delete>

    <!-- 查询单据为待审核的数据 -->
    <select id="selectvo" resultMap="DocumentListVOMap">
        SELECT dm.branchid,dl.dl_number,dm.branchname,dl.dl_date,sl.suppliername,ws.wname,dl.dl_yfje,dl.dl_sfje,dl.dl_qkje,dl.dl_yhje,ag.agent_name,su.user_name,dls.dl_statie_name,dlt.dl_type_name,dl.dl_beizhu
        FROM document_list dl
        LEFT JOIN supplier sl ON dl.supplierid = sl.supplierid
        LEFT JOIN warehouse ws ON dl.wid = ws.wid
        LEFT JOIN agent ag ON dl.agent_id = ag.agent_id
        LEFT JOIN sys_user su ON dl.admin = su.user_id
        LEFT JOIN document_list_static dls  ON dl.dl_statie_id = dls.dl_statie_id
        LEFT JOIN document_list_type dlt ON dl.dl_type_id = dlt.dl_type_id
        LEFT JOIN branch dm ON dm.branchid = sl.companyid
        <where>
            dl.dl_statie_id = 1
            <if test="dlNumber != null  and dlNumber != ''">
                AND dl.dl_number LIKE CONCAT('%',#{dlNumber},'%')
            </if>
            <if test="suppliername != null and  suppliername != ''">
                AND sl.suppliername LIKE CONCAT('%',#{suppliername},'%')
            </if>
            <if test="wname != null and wname != ''">
                AND ws.wname LIKE CONCAT('%',#{wname},'%')
            </if>
            <if test="agentname != null and agentname != ''">
                AND ag.agent_name LIKE CONCAT('%',#{agentname},'%')
            </if>
            <if test="username != null and username != ''">
                AND su.user_name LIKE CONCAT('%',#{username},'%')
            </if>
            <if test="dltypename != null and dltypename != ''">
                AND dlt.dl_type_name LIKE CONCAT('%',#{dltypename},'%')
            </if>
            <if test="dlstatiename != null and dlstatiename != ''">
                AND dls.dl_statie_name LIKE CONCAT('%',#{dlstatiename},'%')
            </if>
            <if test="dlbeizhu != null and dlbeizhu != ''">
                AND dl.dl_beizhu LIKE CONCAT('%',#{dlbeizhu},'%')
            </if>
            <if test="branchname != null and branchname != ''">
                AND dm.branchname LIKE CONCAT('%',#{branchname},'%')
            </if>
        </where>
    </select>

    <!-- 模糊查询单据为待审核的单据 -->
    <select id="likevo" resultMap="DocumentListVOMap">
        SELECT dl.dl_number,dl.dl_date,sl.suppliername,ws.wname,dl.dl_yfje,dl.dl_sfje,dl.dl_qkje,dl.dl_yhje,ag.agent_name,su.user_name,dls.dl_statie_name,dlt.dl_type_name,dl.dl_beizhu
        FROM document_list dl
        LEFT JOIN supplier sl ON dl.supplierid = sl.supplierid
        LEFT JOIN warehouse ws ON dl.wid = ws.wid
        LEFT JOIN agent ag ON dl.agent_id = ag.agent_id
        LEFT JOIN sys_user su ON dl.admin = su.user_id
        LEFT JOIN document_list_static dls  ON dl.dl_statie_id = dls.dl_statie_id
        LEFT JOIN document_list_type dlt ON dl.dl_type_id = dlt.dl_type_id where
        (dl.dl_number LIKE CONCAT('%',#{text},'%') and dl.dl_statie_id = 1)
        or (sl.suppliername LIKE  CONCAT('%',#{text},'%') and dl.dl_statie_id = 1)
        or (ws.wname LIKE CONCAT('%',#{text},'%') and dl.dl_statie_id = 1)
    </select>
    <!-- 将待审核状态的单据改为已审核 -->
    <update id="updatestaticzore">
        update document_list set dl_statie_id = 0,dl_qkje = #{dlQkje},dl_sfje= #{dlSfje},dl_yfje=#{dlYfje} where dl_number = #{dlNumber}
    </update>

    <!-- 查询往来账务中的单据 -->
    <select id="selectwlzw" resultMap="DocumentListVOMap">
        SELECT dl.dl_number,dm.branchname,dl.dl_date,sl.suppliername,ws.wname,dl.dl_yfje,dl.dl_sfje,dl.dl_qkje,dl.dl_yhje,ag.agent_name,su.user_name,dlt.dl_type_name,dls.dl_statie_name,dl.dl_beizhu
        FROM document_list dl
        LEFT JOIN supplier sl ON dl.supplierid = sl.supplierid
        LEFT JOIN warehouse ws ON dl.wid = ws.wid
        LEFT JOIN agent ag ON dl.agent_id = ag.agent_id
        LEFT JOIN sys_user su ON dl.admin = su.user_id
        LEFT JOIN document_list_static dls  ON dl.dl_statie_id = dls.dl_statie_id
        LEFT JOIN document_list_type dlt ON dl.dl_type_id = dlt.dl_type_id
        LEFT JOIN branch dm ON dm.branchid = sl.companyid WHERE dl.dl_statie_id = 0
    </select>

    <!-- 根据俩个时间之间查询单据 -->
    <select id="selectdate" resultMap="DocumentListVOMap">
        SELECT dl.dl_number,dm.branchname,dl.dl_date,sl.suppliername,ws.wname,dl.dl_yfje,dl.dl_sfje,dl.dl_qkje,dl.dl_yhje,ag.agent_name,su.user_name,dlt.dl_type_name,dl.dl_beizhu
        FROM document_list dl
        LEFT JOIN supplier sl ON dl.supplierid = sl.supplierid
        LEFT JOIN warehouse ws ON dl.wid = ws.wid
        LEFT JOIN agent ag ON dl.agent_id = ag.agent_id
        LEFT JOIN sys_user su ON dl.admin = su.user_id
        LEFT JOIN document_list_static dls  ON dl.dl_statie_id = dls.dl_statie_id
        LEFT JOIN document_list_type dlt ON dl.dl_type_id = dlt.dl_type_id
        LEFT JOIN branch dm ON dm.branchid = sl.companyid WHERE DATE_FORMAT(dl.dl_date,'%Y-%m-%d') BETWEEN DATE_FORMAT(#{param1},'%Y-%m-%d') and DATE_FORMAT(#{param2},'%Y-%m-%d') and dl.dl_statie_id = 0
    </select>

    <!-- 根据时间查询单据为待审核的单据 -->
    <select id="selectdatesdanju" resultMap="DocumentListVOMap">
        SELECT dl.dl_number,dl.dl_date,sl.suppliername,ws.wname,dl.dl_yfje,dl.dl_sfje,dl.dl_qkje,dl.dl_yhje,ag.agent_name,su.user_name,dls.dl_statie_name,dlt.dl_type_name,dl.dl_beizhu
        FROM document_list dl
        LEFT JOIN supplier sl ON dl.supplierid = sl.supplierid
        LEFT JOIN warehouse ws ON dl.wid = ws.wid
        LEFT JOIN agent ag ON dl.agent_id = ag.agent_id
        LEFT JOIN sys_user su ON dl.admin = su.user_id
        LEFT JOIN document_list_static dls  ON dl.dl_statie_id = dls.dl_statie_id
        LEFT JOIN document_list_type dlt ON dl.dl_type_id = dlt.dl_type_id
        WHERE DATE_FORMAT(dl.dl_date,'%Y-%m-%d') BETWEEN DATE_FORMAT(#{param1},'%Y-%m-%d') and DATE_FORMAT(#{param2},'%Y-%m-%d') and dl.dl_statie_id = 1
    </select>
    <select id="cgdj" resultMap="CghzVo">
        SELECT l.dl_date,l.dl_number,l.dl_yfje,l.dl_sfje,l.dl_beizhu,a.agent_name,w.wname,sup.suppliername,un.user_name  FROM document_list l
            LEFT JOIN agent a ON l.agent_id=a.id
            LEFT JOIN warehouse w ON l.wid=w.wid
            LEFT JOIN supplier sup ON l.supplierid=sup.supplierid
            LEFT JOIN sys_user un ON l.admin=un.user_id
    </select>

</mapper>

